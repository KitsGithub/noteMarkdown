### 需求背景
1. 目前市场缺少可以指导业绩和业务动作的先导指标，只能依靠直觉和经验做出判断和决策。


### 需求目的

一、为市场提供一个业绩先导指标
1. 帮助上级和员工及时了解自己的业绩目标设置是否合理，业绩达成概率高低，从而及时调整目标，或者为了提高达成概率而加强业务动作。
2. 上级可以通过一个归一化的指标，快速可靠地了解下级团队或成员的当前业绩达成概率，提高发现问题和解决问题的效率。


二、为市场业绩预测提供支持
1. 总办可以根据预测模型来估算未来的业绩，获得有依据的市场预期，并以此为根据来调整市场战略，团队人员规模。
2. 通过预测模型，再设定高、中、低的达成概率，上级可以快速方便地为自己团队设定合理的业绩目标，或者对下级设置不同难度的目标，比如对于新员工可以设定高达成率的目标，对于有闯劲的骨干设定高难度的业绩目标。


三、为B端、E端探索预测模型
该模型是通用的基于参考因子和权重的可能性预测，所以只要修改参考因子的定义和输出结果的定义，就可以复用于B端、E端相关的功能创新，比如访客意向度、房源优推、客户高意向房源、高意向小区等等。


### 需求内容
1. 在任意时刻，业绩达成概率p：
p = 1 / (1 + EXP(-1 * ((20/9))(((Ia * Nt)/I) + ((Id * D)/(Nd * I)) + ((Ip * Dl)/(D * (I - Ic))))-5))
EXP()为以自然常数e为底的指数函数。
2. 业绩目标I关于业绩达成概率p的函数：
I(p) = ((Ia*Nt*Nd+Id*D)*D + Ip*Dl*Nd)/(Nd*D*(9/4 - (9/20)*LN((1/p)-1)))
LN()为EXP()的反函数。


### 公式生成
一、简介
1. 业绩达成概率预测模型是以多个重要参考因子及其权重建立的数据模型，通过持续将{历史数据，历史结果}数据对，输入模型训练得到不同参考因子的权重，从而得到可靠的预测模型。
2. 概率模型构建步骤
2.1 确定主要的影响因子
2.2 定义影响因子的相关参数和计算方式，设置因子权重
2.3 计算所有影响因子的特征值，并求和得到特征值和P
2.4 求Sigmoid函数Y(x)的自变量x关于P的函数x(P)
2.5 求得Sigmoid函数关于特征值和P的函数Y(P)
2.6 输入多组{特征值，结果}数据训练模型，得到各影响因子的因子权重
2.7 得到靠谱的Y(P)
2.8 根据Y(P)，输入参数，得到概率
3. 根据设定结果Y反推参数X
3.1 根据Y(P)求得参数X关于Y的函数X(Y)
3.2 代入设定结果Y，求得参数X


二、三个影响因子
1. 近Nm个有效月的团队人效
2. 近Nd日的团队业绩
3. 商机向未完成业绩转化


三、参数定义
1. 近Nm个有效月的团队人效-相关参数
1.1 每个有效月的团队人均业绩{Ia1，Ia2，……，IaNm}
1.2 当前团队人数Nt
1.3 本月业绩目标I
1.4 因子权重w1
2. 近Nd日的团队业绩-相关参数：
2.1 近Nd日的业绩Id
2.2 本月天数D
2.3 本月业绩目标I
2.4 因子权重w2
3. 商机向未完成业绩转化相关参数
3.1 商机预测业绩Ip(lp = ∑(阶段商机额 * 阶段赢率))
3.2 销售周期T
3.3 本月剩余天数Dl
3.4 本月天数D
3.5 本月已达成业绩Ic
3.6 因子权重w3


四、近Nm个有效月的团队人效-概率P1
1. 近Nm个有效月的团队人效均值Ia = (∑Iax) / Nm
2. P1 = ((Ia * Nt)/I) * w1 = (Ia * Nt * w1)/I


五、近Nd日的团队业绩-概率P2
1. P2 = (((Id / Nd) * D)/I) * w2 = (Id * D * w2)/(Nd * I) 


六、商机向未完成业绩转化-概率P3
1. 本月商机预测业绩Imp = Ip / T
2. 本月商机预测转化业绩 lmpa = Imp * (Dl / D) = (Ip * Dl) / (T * D)
3. P3 = (Impa/(I - Ic))  * w3 = (Ip * Dl * w3) / (T * D * (I - Ic)) 


七、汇总影响因子 - 概率和P
1. P = P1 + P2 + P3


八、求Sigmoid函数Y(x)的自变量x关于P的函数x(P)
1. 令P1=0时，近Nm个有效月的团队人效概率为0；令P1=1.5时，近Nm个有效月的团队人效概率约等于1；得P1 ∈ [0 , 1.5]。
2. 令P2=0时，近Nd日的团队业绩概率为0；令P2=1.5时，近Nd日的团队业绩概率约等于1；得P2 ∈  [0 , 1.5]。
3. 令P3=0时，商机向未完成业绩转化概率为0；令P3=1.5时，商机向未完成业绩转化概率约等于1；得P3 ∈  [0 , 1.5]。
4. Sigmoid函数的定义域为[-5,5]时，值域为(0,1)
5. 求得x(P) = (20/9)P-5


九、业绩达成概率Y
1. Y1 = Sigmoid(x) = Sigmoid((20/9)P-5) = Sigmoid((20/9)(P1+P2+P3)-5) = 1 / (1 + EXP(-1 * ((20/9)(P1+P2+P3)-5)))，代入P1,P2,P3得到：
Y1 = 1/(1 + EXP(-1 * ((20/9))(((Ia * Nt * w1)/I) + ((Id * D * w2)/(Nd * I)) + ((Ip * Dl * w3)/(T * D * (I - Ic))))-5))
2. 引入宏观因子，E∈(0.5,1.5]，越接近0.5越悲观，1为正常，越接近1.5越乐观。
Y = E * Y1 = E * Sigmoid((20/9)(P1+P2+P3)-5) = E * (1/(1 + EXP(-1 * ((20/9))(P1+P2+P3)-5)))，代入P1,P2,P3得到：
Y = E * (1 / (1 + EXP(-1 * ((20/9))(((Ia * Nt * w1)/I) + ((Id * D * w2)/(Nd * I)) + ((Ip * Dl * w3)/(T * D * (I - Ic))))-5)))
3. 因为Sigmoid函数单调递增，所以Y ∝P，在任意确定的日期，可以得到
Y ∝ Nt，即业绩达成概率与团队人数成正比
Y ∝ Ip，即业绩达成概率与商机预测业绩成正比
Y ∝ 1/I，即业绩达成概率与业绩目标成反比
Y ∝ 1/T，即业绩达成概率与销售周期成反比
又因为：商机预测业绩Ip = 商机数 * 客单价 * 商机赢率，
所以为了提高业绩达成概率，可以：
3.1 增加当前团队人数
3.2 增加商机数
3.3 提高客单价
3.4 提高商机赢率
3.5 降低销售周期
3.6 降低业绩目标



十、模型训练
1. 因为缺乏历史数据，所以暂时无法训练
2. 暂取w1=w2=w3=1


十一、其他常量取值
取Nm = 3，Nd = 10，T = 1(单位为月)，E = 1


十二、计算业绩达成概率
1. 可以带入常量和团队当前数据，就可以按照模型计算业绩达成概率了
2. 按照该模型，则可得12月15日时，团队的业绩达成概率和最终结果的情况如下：

||团队名称/数据||业绩达成概率||是否达成目标||业绩目标||业绩结果||结果/目标||
||陈李鹏团队 || 71.1%||否 || 150||143.2|| 95.3%||
||李安团队 || 95.8%|| 是|| 116||125.5|| 108.2%||
||秦显媚团队|| 11.9%|| 否|| 130||59.5|| 45.8%||
||罗映勤团队 || 20.4%|| 否|| 20||14.3|| 71.2%||
|| 王龙团队||21.9% || 否|| 17||12.9|| 75.9%||


十三、按照业绩达成概率制定目标
1. Y(x) = Sigmoid(x)的反函数为Y(x) = -IN((1/x)-1)，Y(x) = (20/9)P-5 = -IN((1/x)-1)，所以概率和P关于业绩概率x的函数P(x) = 9/4 - (9/20)*ln((1/x)-1)
2. P(x) = P1+P2+P3 = (Ia * Nt * w1)/I + (Id * D * w2)/(Nd * I) + (Ip * Dl * w3) / (T * D * (I - Ic))，因为月初lc=0，w1=w2=w3=1，所以P(x) = (Ia*Nt)/I + (Id*D)/(Nd*I) + (Ip*Dl)/(T*D*I) = ((Ia*Nt*Nd+Id*D)*T*D + Ip*Dl*Nd)/(Nd*T*D*I)
3. 根据上式可得业绩目标I关于概率和P的函数I(P) =  ((Ia*Nt*Nd+Id*D)*T*D + Ip*Dl*Nd)/(Nd*T*D*P), 代入概率和P关于业绩概率x的函数P(x) = 9/4 - (9/20)*LN((1/x)-1),得到业绩目标I关于业绩概率x的函数：
I(x) = ((Ia*Nt*Nd+Id*D)*T*D + Ip*Dl*Nd)/(Nd*T*D*(9/4 - (9/20)*LN((1/x)-1)))


十四、测试业绩目标
1.  取高概率基线80%，中概率基线60%，低概率基线40%
2. 求不同达成概率下的业绩目标
2.1 令x = 80%，可求得高概率业绩目标I(x)
2.2 令x = 60%，可求得中概率业绩目标I(x)
2.3 令x = 40%，可求得低概率业绩目标I(x)
2.4 按照该模型，令1月宏观因子E=1，即正常，则可得以下团队1月的业绩目标：

||团队名称/数据||12月月底业绩结果||12月业绩目标||1月达成概率高(80%)||1月达成概率中(60%)||1月达成概率低(40%)||
||陈李鹏团队 || 143.2||150||147.3 || 174.1||204.8|| 
||李安团队 || 125.5||116|| 122.2|| 144.3||169.8|| 
||秦显媚团队|| 59.5||130|| 75.2|| 88.9||104.6|| 
||罗映勤团队 || 14.3||20|| 13.2|| 15.6||18.3|| 
|| 王龙团队||12.9 || 17||11.7|| 13.9||16.3|| 

[计算相关数据表格](https://docs.qq.com/sheet/DUkNLc1hBU1ZzZVpa?c=F19A0A0)